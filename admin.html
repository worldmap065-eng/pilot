<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Pilot Studio Pro | Visual Builder</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --apple-blue: #0071e3; --bg: #000; --sidebar: #161617; --panel: #1c1c1e; }
        * { box-sizing: border-box; font-family: 'SF Pro Display', -apple-system, sans-serif; }
        body { margin: 0; background: var(--bg); color: white; display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar -  驻  */
        .sidebar { 
            width: 280px; background: var(--sidebar); border-left: 1px solid #333; 
            display: flex; flex-direction: column; padding: 20px; z-index: 100;
        }
        .nav-section { margin-bottom: 30px; }
        .section-title { font-size: 11px; font-weight: 700; color: #86868b; text-transform: uppercase; margin-bottom: 12px; }
        .page-item { 
            padding: 10px 15px; border-radius: 8px; cursor: pointer; margin-bottom: 5px;
            transition: 0.2s; font-size: 14px; display: flex; align-items: center; justify-content: space-between;
        }
        .page-item:hover { background: #2c2c2e; }
        .page-item.active { background: var(--apple-blue); color: white; }

        /* Toolbar - 转爪转 驻注转 */
        .top-nav {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(28, 28, 30, 0.8); backdrop-filter: blur(20px);
            padding: 8px 20px; border-radius: 30px; display: flex; gap: 15px; border: 1px solid #333; z-index: 1000;
        }
        .tool-btn { background: none; border: none; color: white; cursor: pointer; padding: 5px 12px; border-radius: 15px; font-size: 13px; }
        .tool-btn.active { background: #333; font-weight: 600; }

        /* Canvas - 专 注 */
        .workspace { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; background: #000; overflow: auto; padding: 60px; }
        
        /*  砖专 */
        .preview-container {
            background: white; border-radius: 32px; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 50px 100px rgba(0,0,0,0.5); overflow: hidden; position: relative;
        }
        .desktop-view { width: 100%; max-width: 1100px; height: 90vh; }
        .mobile-view { width: 375px; height: 750px; border: 12px solid #1c1c1e; }

        iframe { width: 100%; height: 100%; border: none; }

        /* Floating Editor Menu - 转驻专 砖驻注 砖爪 注  */
        #floating-menu {
            position: absolute; background: #2c2c2e; border: 1px solid #444; padding: 10px;
            border-radius: 12px; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 2000;
            flex-direction: column; gap: 8px; width: 200px;
        }
        #floating-menu input { background: #161617; border: 1px solid #444; color: white; padding: 6px; border-radius: 6px; font-size: 12px; }

        /* Publish Button */
        .publish-btn {
            position: fixed; bottom: 30px; left: 30px; background: white; color: black;
            padding: 12px 25px; border-radius: 20px; font-weight: 700; cursor: pointer; border: none;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="nav-section">
        <div class="section-title">Pages</div>
        <div id="pages-list">
            <div class="page-item active" onclick="switchPage('index.html', this)">Home (index.html)</div>
            <div class="page-item" onclick="switchPage('about.html', this)">About (about.html)</div>
        </div>
        <button onclick="addNewPage()" style="width:100%; margin-top:10px; background:none; border:1px dashed #444; color:#86868b; padding:8px; border-radius:8px; cursor:pointer;">+ Add New Page</button>
    </div>

    <div class="nav-section">
        <div class="section-title">Elements</div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="page-item" draggable="true" ondragstart="handleDrag('button')"> Button</div>
            <div class="page-item" draggable="true" ondragstart="handleDrag('text')"> Text</div>
        </div>
    </div>
</div>

<div class="top-nav">
    <button class="tool-btn active" id="btn-desktop" onclick="setDevice('desktop')">Desktop</button>
    <button class="tool-btn" id="btn-mobile" onclick="setDevice('mobile')">Mobile</button>
</div>

<div class="workspace">
    <div id="preview-box" class="preview-container desktop-view">
        <iframe src="index.html" id="editor-iframe"></iframe>
    </div>
</div>

<div id="floating-menu">
    <label style="font-size: 10px; color:#86868b;">Link URL (for buttons)</label>
    <input type="text" id="link-input" placeholder="https://..." oninput="updateElementLink()">
    <button onclick="deleteElement()" style="background:#ff3b30; color:white; border:none; padding:5px; border-radius:5px; cursor:pointer; font-size:12px;">Delete Element</button>
</div>

<button class="publish-btn" onclick="saveSite()">Publish Live</button>

<script>
    const API = "https://YOUR-RENDER-URL.onrender.com";
    let selectedElement = null;

    // 砖 转爪转 砖专
    function setDevice(type) {
        const box = document.getElementById('preview-box');
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        if(type === 'mobile') {
            box.className = "preview-container mobile-view";
            document.getElementById('btn-mobile').classList.add('active');
        } else {
            box.className = "preview-container desktop-view";
            document.getElementById('btn-desktop').classList.add('active');
        }
    }

    // 注专  驻
    function switchPage(url, el) {
        document.querySelectorAll('.page-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('editor-iframe').src = url;
    }

    // 注专 转 -Iframe
    const iframe = document.getElementById('editor-iframe');
    iframe.onload = function() {
        const doc = iframe.contentDocument || iframe.contentWindow.document;

        // 专  转 注专  砖 驻专注
        const bot = doc.getElementById('chat-wrapper');
        if(bot) bot.style.display = 'none';

        // 驻转 拽住 注专
        doc.querySelectorAll('h1, p, span, button').forEach(el => {
            el.contentEditable = true;
            el.addEventListener('click', (e) => {
                e.preventDefault();
                openFloatingMenu(el, e);
            });
        });
    };

    function openFloatingMenu(el, e) {
        selectedElement = el;
        const menu = document.getElementById('floating-menu');
        menu.style.display = 'flex';
        // 拽 转驻专  住
        menu.style.top = e.clientY + 'px';
        menu.style.left = (e.clientX + 50) + 'px';
        
        if(el.tagName === 'BUTTON' || el.tagName === 'A') {
            document.getElementById('link-input').value = el.getAttribute('onclick') || '';
        }
    }

    function updateElementLink() {
        if(selectedElement) {
            const url = document.getElementById('link-input').value;
            selectedElement.setAttribute('onclick', `window.location.href='${url}'`);
        }
    }

    function deleteElement() {
        if(selectedElement && confirm('Delete this element?')) {
            selectedElement.remove();
            document.getElementById('floating-menu').style.display = 'none';
        }
    }

    async function saveSite() {
        const doc = iframe.contentDocument;
        const fullHtml = doc.documentElement.innerHTML;
        alert("Saving version to server...");
        //  转砖 转 fullHtml 砖专转
    }

    function addNewPage() {
        const name = prompt("Page Name (e.g. services.html):");
        if(name) {
            const list = document.getElementById('pages-list');
            const div = document.createElement('div');
            div.className = "page-item";
            div.innerText = name;
            list.appendChild(div);
        }
    }
</script>

</body>
</html>
