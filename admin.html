// משתנה שישמור את האלמנט שנבחר
let selectedElement = null;

// 1. האזנה ללחיצות על אלמנטים באתר
document.addEventListener('click', function(e) {
    // אם לחצנו על אלמנט שניתן לעריכה
    if (e.target.classList.contains('editable')) {
        selectElement(e.target);
    } 
    // אם לחצנו במקום ריק באתר (מחוץ לאלמנט)
    else if (e.target.id === 'live-site' || e.target.id === 'site-wrapper') {
        deselectAll();
    }
});

function selectElement(el) {
    deselectAll(); // נקה בחירות קודמות
    selectedElement = el;
    selectedElement.classList.add('selected-node');

    // מילוי השדות בצד ימין בערכים של האלמנט
    document.getElementById('prop-text').value = el.innerText;
    
    const style = window.getComputedStyle(el);
    document.getElementById('prop-size').value = parseInt(style.fontSize);
    document.getElementById('prop-radius').value = parseInt(style.borderRadius) || 0;
}

function deselectAll() {
    if (selectedElement) {
        selectedElement.classList.remove('selected-node');
        selectedElement = null;
    }
}

// 2. חיבור השדות בצד ימין (INPUTS)
document.getElementById('prop-text').addEventListener('input', (e) => {
    if (selectedElement) selectedElement.innerText = e.target.value;
});

document.getElementById('prop-color').addEventListener('input', (e) => {
    if (selectedElement) selectedElement.style.color = e.target.value;
});

document.getElementById('prop-size').addEventListener('input', (e) => {
    if (selectedElement) selectedElement.style.fontSize = e.target.value + 'px';
});

document.getElementById('prop-radius').addEventListener('input', (e) => {
    if (selectedElement) selectedElement.style.borderRadius = e.target.value + 'px';
});

// 3. הוספת אלמנטים חדשים
function addNode(type) {
    const container = document.getElementById('live-site');
    const el = document.createElement(type);
    el.className = 'editable';
    el.innerText = type === 'button' ? 'כפתור חדש' : 'טקסט חדש';
    
    if (type === 'button') {
        el.style.background = '#0071e3';
        el.style.color = 'white';
        el.style.padding = '12px 24px';
        el.style.border = 'none';
        el.style.borderRadius = '12px';
        el.style.display = 'inline-block';
    }
    
    container.appendChild(el);
    selectElement(el);
}

// 4. מחיקה
function deleteNode() {
    if (selectedElement) {
        selectedElement.remove();
        selectedElement = null;
    }
}

// 5. שינוי תצוגה (מובייל/דסקטופ)
function setDevice(mode) {
    const wrapper = document.getElementById('site-wrapper');
    if (mode === 'mobile') wrapper.classList.add('mobile');
    else wrapper.classList.remove('mobile');
}
